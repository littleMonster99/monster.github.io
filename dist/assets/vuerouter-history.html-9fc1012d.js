import{_ as p,W as o,X as i,Y as n,Z as a,$ as t,a0 as s,D as l}from"./framework-f64bc974.js";const c={},r=s(`<h1 id="vue实战-vuerouter-history模式" tabindex="-1"><a class="header-anchor" href="#vue实战-vuerouter-history模式" aria-hidden="true">#</a> Vue实战 - VueRouter History模式</h1><h2 id="_1-背景" tabindex="-1"><a class="header-anchor" href="#_1-背景" aria-hidden="true">#</a> 1. 背景</h2><p><code>vue-router</code> 默认 hash 模式 —— 使用 URL 的 hash 来模拟一个完整的 URL，<strong>于是当 URL 改变时，页面不会重新加载</strong>。</p><p>如果不想要很丑的 hash，我们可以用路由的 <strong>history 模式</strong>，这种模式充分利用 <code>history.pushState</code> API 来完成 URL 跳转而无须重新加载页面。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;history&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当你使用 history 模式时，URL 就像正常的 url，例如 <code>http://yoursite.com/user/id</code></p><h3 id="_1-1-未正确配置导致404的问题" tabindex="-1"><a class="header-anchor" href="#_1-1-未正确配置导致404的问题" aria-hidden="true">#</a> 1.1 未正确配置导致404的问题</h3><p>history 虽好，但是未正确配置，会导致页面404。</p><p><strong>解决方案</strong>：</p><p>在访问到404的时候，需要定位到首页，也就是index.html页</p><h2 id="_2-前端配置" tabindex="-1"><a class="header-anchor" href="#_2-前端配置" aria-hidden="true">#</a> 2. 前端配置</h2><h3 id="_2-1-放域名根目录下" tabindex="-1"><a class="header-anchor" href="#_2-1-放域名根目录下" aria-hidden="true">#</a> 2.1 放域名根目录下</h3>`,12),u={href:"http://oursite.com",target:"_blank",rel:"noopener noreferrer"},d=s(`<ol><li><p>路由配置：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>export <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> &#39;history&#39;<span class="token punctuation">,</span> <span class="token comment">// 去掉url中的#</span>
  scrollBehavior<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> y<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  routes<span class="token operator">:</span> constantRoutes
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置 vue.config.js 文件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 部署生产环境和开发环境下的URL。应用被部署在一个子路径,需指向相对路径或特定路径</span>
  <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 用于放置生成的静态资源 (js、css、img、fonts) 的；（项目打包之后，静态资源会放在这个文件夹下）</span>
  <span class="token literal-property property">assetsDir</span><span class="token operator">:</span> <span class="token string">&#39;static&#39;</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="_2-2-放域名二级目录下" tabindex="-1"><a class="header-anchor" href="#_2-2-放域名二级目录下" aria-hidden="true">#</a> 2.2 放域名二级目录下</h3>`,2),k={href:"http://oursite.com/myapp",target:"_blank",rel:"noopener noreferrer"},m=s(`<ol><li><p>路由配置：</p><p>除了mode 还需要配置 base、base 这里是要写死的目录（所以还不能动态设置、nginx 需要与前端保持一致）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;history&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 去掉url中的#</span>
  <span class="token comment">// 应用的基路径。例如，如果整个单页应用服务在 /myapp/ 下，然后 base 就应该设为 &quot;/myapp/&quot;</span>
  <span class="token literal-property property">base</span><span class="token operator">:</span><span class="token string">&#39;/myapp/&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 新增base</span>
  <span class="token function-variable function">scrollBehavior</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">routes</span><span class="token operator">:</span> constantRoutes
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置 vue.config.js 文件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 部署生产环境和开发环境下的URL。应用被部署在一个子路径,需指向相对路径或特定路径</span>
  <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> <span class="token comment">//指向相对路径</span>
  <span class="token comment">//publicPath: &quot;/myapp/&quot;, // 固定路径</span>
  <span class="token comment">// 用于放置生成的静态资源 (js、css、img、fonts) 的；（项目打包之后，静态资源会放在这个文件夹下）</span>
  <span class="token literal-property property">assetsDir</span><span class="token operator">:</span> <span class="token string">&#39;static&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 不需要修改也不影响</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="_3-后端配置" tabindex="-1"><a class="header-anchor" href="#_3-后端配置" aria-hidden="true">#</a> 3. 后端配置</h2><h3 id="_3-1-nginx-配置" tabindex="-1"><a class="header-anchor" href="#_3-1-nginx-配置" aria-hidden="true">#</a> 3.1 nginx 配置</h3><h4 id="_3-1-1-放域名根目录下" tabindex="-1"><a class="header-anchor" href="#_3-1-1-放域名根目录下" aria-hidden="true">#</a> 3.1.1 放域名根目录下</h4><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code>	<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">9802</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   /home/myapp</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
						<span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-2-放域名二级目录下" tabindex="-1"><a class="header-anchor" href="#_3-1-2-放域名二级目录下" aria-hidden="true">#</a> 3.1.2 放域名二级目录下</h4><div class="language-nginx line-numbers-mode" data-ext="nginx"><pre class="language-nginx"><code>	<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>          <span class="token number">19801</span></span><span class="token punctuation">;</span>
        
        <span class="token directive"><span class="token keyword">location</span> /myapp</span> <span class="token punctuation">{</span>    
            <span class="token directive"><span class="token keyword">alias</span>   /home/myapp</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /myapp/index.html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-tomcat" tabindex="-1"><a class="header-anchor" href="#_3-2-tomcat" aria-hidden="true">#</a> 3.2 tomcat</h3><h4 id="_3-2-1-放域名根目录下" tabindex="-1"><a class="header-anchor" href="#_3-2-1-放域名根目录下" aria-hidden="true">#</a> 3.2.1 放域名根目录下</h4><p>tomcat基本很少直接放在根目录下的情况，不做介绍</p><h4 id="_3-2-2-放域名二级目录下" tabindex="-1"><a class="header-anchor" href="#_3-2-2-放域名二级目录下" aria-hidden="true">#</a> 3.2.2 放域名二级目录下</h4><ol><li><p>前端在public目录下新增：WEB-INF/web.xml文件</p><p>在前端再打包输出的文件中，还需要新增WEB-INF文件夹，并包含一个web.xml文件</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://xmlns.jcp.org/xml/ns/javaee/web-app_2_5.xsd<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scplatform<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2.5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-page</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-code</span><span class="token punctuation">&gt;</span></span>404<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-code</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>location</span><span class="token punctuation">&gt;</span></span>/index.html<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>location</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-page</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210529154237920.png" alt="image-20210529154237920" tabindex="0" loading="lazy"><figcaption>image-20210529154237920</figcaption></figure></li><li><p>打包之后dist(打包目录)，下会新增WEB-INF文件夹</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210529154331815.png" alt="image-20210529154331815" tabindex="0" loading="lazy"><figcaption>image-20210529154331815</figcaption></figure></li><li><p>将文件放到tomcat的webapps目录下即可</p></li></ol><h2 id="_4-可能遇到的问题" tabindex="-1"><a class="header-anchor" href="#_4-可能遇到的问题" aria-hidden="true">#</a> 4. 可能遇到的问题</h2><h3 id="_4-1-初次进入可以-刷新页面后404-页面地址变成根目录" tabindex="-1"><a class="header-anchor" href="#_4-1-初次进入可以-刷新页面后404-页面地址变成根目录" aria-hidden="true">#</a> 4.1 初次进入可以，刷新页面后404(页面地址变成根目录)</h3>`,14),v={href:"http://oursite.com/myapp%EF%BC%8C%E5%8F%98%E6%88%90%E6%A0%B9%E7%9B%AE%E5%BD%95http://oursite.com%E3%80%82%E6%89%80%E4%BB%A5%E6%97%A0%E6%B3%95%E5%88%B7%E6%96%B0",target:"_blank",rel:"noopener noreferrer"},h=s('<p><strong>解决方案</strong></p><p>好好检查配置！特别是</p><ul><li>路由的base 是否配置正确</li></ul><h3 id="_4-2-初次进入可以-刷新页面后404-页面地址不变-刷新就是不行" tabindex="-1"><a class="header-anchor" href="#_4-2-初次进入可以-刷新页面后404-页面地址不变-刷新就是不行" aria-hidden="true">#</a> 4.2 初次进入可以，刷新页面后404(页面地址不变，刷新就是不行)</h3><p>初次进入可以，刷新页面后404(页面地址不变，刷新就是不行)</p><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210529142826597.png" alt="image-20210529142826597" tabindex="0" loading="lazy"><figcaption>image-20210529142826597</figcaption></figure><p><strong>解决方案</strong></p><p>好好检查配置！特别是</p><ul><li>nginx配置是否有加：try_files $uri $uri/ /myapp/index.html;</li></ul><h3 id="_4-3-页面进入后相关资源找不到" tabindex="-1"><a class="header-anchor" href="#_4-3-页面进入后相关资源找不到" aria-hidden="true">#</a> 4.3 页面进入后相关资源找不到</h3><figure><img src="https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210529142019445.png" alt="image-20210529142019445" tabindex="0" loading="lazy"><figcaption>image-20210529142019445</figcaption></figure><p>我们指定二级目录了，但是资源还是一级目录的地址。</p><p><strong>解决方案</strong></p><p>好好检查配置！特别是</p><ul><li>配置 vue.config.js 文件，publicPath: &quot;./&quot;, //指向相对路径，或者全路径</li></ul>',15);function g(b,y){const e=l("ExternalLinkIcon");return o(),i("div",null,[r,n("p",null,[a("域名根目录下，如："),n("a",u,[a("http://oursite.com"),t(e)])]),d,n("p",null,[a("域名二级目录下。如："),n("a",k,[a("http://oursite.com/myapp"),t(e)])]),m,n("p",null,[a("初次进入可以，刷新页面后404，页面路径由原来的二级目录"),n("a",v,[a("http://oursite.com/myapp，变成根目录http://oursite.com。所以无法刷新"),t(e)])]),h])}const _=p(c,[["render",g],["__file","vuerouter-history.html.vue"]]);export{_ as default};
