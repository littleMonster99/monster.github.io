import{_ as a,W as t,X as c,Y as o,Z as e,$ as n,a0 as d,D as s}from"./framework-f64bc974.js";const l={},i=d(`<h2 id="mongodb异常关闭后-如何修复启动" tabindex="-1"><a class="header-anchor" href="#mongodb异常关闭后-如何修复启动" aria-hidden="true">#</a> mongodb异常关闭后，如何修复启动</h2><h2 id="_1-背景" tabindex="-1"><a class="header-anchor" href="#_1-背景" aria-hidden="true">#</a> 1. 背景</h2><p>当独立的<code>mongod</code>实例禁用日记功能时，<strong>不正常的关闭可能会使数据处于不一致状态</strong>。异常关闭后，如果存在非空的<code>mongod.lock</code>文件，则mongod实例在重新启动时记录以下消息：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Detected unclean shutdown - mongod.lock is not empty.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果dbPath包含非空的<code>mongod.lock</code>文件，则必须修复数据库</p>`,5),h={href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/reference-glossary.html#term-replica-set",target:"_blank",rel:"noopener noreferrer"},m={href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/core-backups.html",target:"_blank",rel:"noopener noreferrer"},p={href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/tutorial-resync-replica-set-member.html",target:"_blank",rel:"noopener noreferrer"},g={href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/core-journaling.html",target:"_blank",rel:"noopener noreferrer"},_={href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/tutorial-manage-mongodb-processes.html#terminate-mongod-processes",target:"_blank",rel:"noopener noreferrer"},b=d(`<h2 id="_2-以-repair-启动-mongod" tabindex="-1"><a class="header-anchor" href="#_2-以-repair-启动-mongod" aria-hidden="true">#</a> 2. 以--repair 启动 mongod</h2><p>要修复数据文件，请使用<code>--repair</code>选项启动<code>mongod</code>实例。默认情况下，在修复操作期间，MongoDB 使用<code>--dbpath</code>中的<code>_tmp</code>目录。</p><p>发出类似于以下内容的命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mongod --dbpath /data/db --repair
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>完成后，<code>dbpath</code>应包含已修复的数据文件和一个空的<code>mongod.lock</code>文件。</p><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2>`,6),u={href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/tutorial-recover-data-following-unexpected-shutdown.html#%E4%BB%A5--repair-%E5%90%AF%E5%8A%A8-mongod",target:"_blank",rel:"noopener noreferrer"};function f(v,w){const r=s("ExternalLinkIcon");return t(),c("div",null,[i,o("blockquote",null,[o("p",null,[e("不要使用本教程恢复"),o("a",h,[e("replica set"),n(r)]),e("的成员。相反，您应该从"),o("a",m,[e("backup"),n(r)]),e("恢复，或者从集合的另一个成员重新同步，如"),o("a",p,[e("重新同步副本集的成员"),n(r)]),e("中所述。")])]),o("blockquote",null,[o("p",null,[e("默认情况下，MongoDB 在启用"),o("a",g,[e("journaling"),n(r)]),e("的情况下运行，以防止在关闭时出现数据不一致的情况。要彻底关闭，请参阅"),o("a",_,[e("停止 mongod 进程"),n(r)]),e("。")])]),b,o("p",null,[o("a",u,[e("意外关闭后恢复独立服务器"),n(r)])])])}const k=a(l,[["render",f],["__file","mongodb-problem-repair.html.vue"]]);export{k as default};
